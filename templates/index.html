<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="https://d3js.org/d3.v4.js"></script>
		<script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
      <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&__ec_v__=20190126"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
      <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
        <script src="../static/scripts/d3.layout.cloud.js"></script>
        <script src="../static/scripts/d3-legend.min.js"></script>
        <script scr="../static/scripts/D1per10min.js"></script>
        <script src = "../static/scripts/DrawRoute.js"></script>
		<script src = "../static/scripts/d1labelcountper10min.js"></script>
		<script src = "../static/scripts/d2labelcountper10min.js"></script>
		<script src = "../static/scripts/d3labelcountper10min.js"></script>
		<script src = "../static/scripts/d1labelcountpermin.js"></script>
		<script src = "../static/scripts/d2labelcountpermin.js"></script>
		<script src = "../static/scripts/d3labelcountpermin.js"></script>
        <script src = "../static/scripts/number_time_day1.js"></script>
        <script src = "../static/scripts/number_time_day2.js"></script>
        <script src = "../static/scripts/number_time_day3.js"></script>
    	<script src = "../static/scripts/sensor_deployment.js"></script>
        <script src = "../static/scripts/id_label.js"></script>
        <script src = "../static/scripts/D1per10min.js"></script>
        <script src = "../static/scripts/D2per10min.js"></script>
        <script src = "../static/scripts/D3per10min.js"></script>
    	<!-- <script src = "../static/scripts/sensor_deployment.js"></script> -->
        <script src = "../static/scripts/DrawBubble.js"></script>
        <script src = "../static/scripts/DrawChord.js"></script>
				<script src = "../static/scripts/DrawWordCloud.js"></script>
        <link href="../static/css/style.css"  rel="stylesheet" type="text/css" media="all" />
        <style>
            /*#day_route{*/
                /*background: url(https://github.com/Angeladadd/ChinaVis2019/blob/cc86772a65976d4ad933450d589f0790444a1042/static/img/background.png);*/
            /*}*/
        </style>
        <script>
            // var label = [];
            // for (var key in id_label){
            //     var tmp = id_label[key];
            //     if(label.indexOf(tmp)>=0){
            //         continue;
            //     }
            //     else{
            //         label.push(tmp);
            //         document.write(tmp+" ");
            //     }
            // }
            data_day1 = {{data_day1|tojson}}
            data_day2 = {{data_day2|tojson}}
            data_day3 = {{data_day3|tojson}}
            sensor_deployment = {{sensor|tojson}}
            //基本数据
            var sensor = {x_max:15,x_min:0,y_max:28,y_min:0};
            BASIC_DATA = {sensor:sensor,people_MAX:25};
            var people_map = {};
            var sensor_map = {};
            for(var i=0;i<sensor_deployment.length;i++){
                sensor_map[sensor_deployment[i].sid] = i;
            }
            //统计一天的people，目前只处理了第一天的，还不知道这个代码到时候放哪
            //这个地方非常瓶颈，建议后端直接做成json，后端如果要加的话尽量把people做成这个数据结构8
            people = new Array(3);
            people[0] = new Array(0);
            people[1] = new Array(0);
            people[2] = new Array(0);
            var cnt = -1;
            //为了加载快，这里只计算一天
            //第二天修改所有的people[0]为 people[1], data_day1为data_day2
            for(var i=0;i<data_day1.length;i++){
                let id = data_day1[i].id;
                let sid = data_day1[i].sid;
                let time = data_day1[i].time;
                var d_obj;
                if(!people_map.hasOwnProperty(id)){
                    cnt++;
                    people_map[id] = cnt;
                    people[0][cnt] = new Array(0);
                    d_obj = {};
                    var sensor_tmp = sensor_deployment[sensor_map[sid]];
                    d_obj.x = parseInt(-1);
                    d_obj.y = parseInt(-1);
                    d_obj.floor = parseInt(sensor_tmp.floor);
                    d_obj.time = parseInt(time);
                    d_obj.id = parseInt(id);
                    d_obj.sensor_simple_id = sensor_map[sid];
                    people[0][cnt].push(d_obj);
                }
                var index = parseInt(people_map[id]);
                var obj = {};
                var sensor_tmp = sensor_deployment[sensor_map[sid]];
                obj.x = parseInt(sensor_tmp.x);
                obj.y = parseInt(sensor_tmp.y);
                obj.floor = parseInt(sensor_tmp.floor);
                obj.time = parseInt(time);
                obj.id = parseInt(id);
                obj.sensor_simple_id = sensor_map[sid];
                if(people[0][index]) people[0][index].push(obj);
            }
            for(var i=0;i<people[0].length;i++)
                people[0][i].push(d_obj);
            MAP = {people_map:people_map,sensor_map:sensor_map};
            sensor_all_floor = new Array(0);
            for(let i=0;i<sensor_deployment.length;i++){
                sensor_all_floor.push(sensor_deployment[i]);
            }
        </script>

    </head>

    <body>
    <div class="wpbox">
<div class="bnt">
  <div class="topbnt_left fl">
      <!--这里是可以跳新页面的操作-->
   <ul><li class="active"><a href="#">警情警力</a></li>
      <li><a href="#">实有人口</a></li>
      <li><a href="#">流动人口</a></li>
      <li><a href="#">实名制</a></li>
   </ul>
  </div>
  <h1 class="tith1 fl">China Vis 2019</h1>
  <div class=" fr topbnt_right">
    <ul>
       <li><a href="#">返回</a></li>
       <li><a href="#">分析报告</a></li>
       <li><a href="#">交通</a></li>
       <li><a href="#">舆情</a></li>
    </ul>
   </ul>
  </div>
</div>
<!-- bnt end -->
<div class="left1">
    <div class="aleftboxttop"><h2 class="tith2">今日矛盾纠纷数据统计</h2>
    <div class="lefttoday_tit" style=" height:8%"><p class="fl">地区：甘孜</p><p class="fr">2018-06-14</p></div>
    <div class="lefttoday_number">
      <div class="widget-inline-box text-center fl">
      </div>
    </div>
    <!-- lefttoday_number end -->
    </div>
    <div class="aleftboxtmidd">
      <h2 class="tith2">矛盾纠纷地区统计</h2>
      
      <div id="aleftboxtmidd" class="aleftboxtmiddcont"></div>
  </div>
  <div class="aleftboxtbott">
    <h2 class="tith2">矛盾纠纷类型统计</h2>
    <div id="aleftboxtbott" class="aleftboxtbott_cont" >
        <div id="chord">
         <svg width="280" height="280"></svg>
        </div>
    </div>
</div>
</div>
<!--  left1 end -->
<div class="mrbox">
      <div class="mrbox_topmidd" style="width: 69%;">
          <div class="amiddboxttop">
              <h2 class="tith2 pt1">实时监控统计</h2>
                <div class="amiddboxttop_map" style="">
                    <div id="main_active">
        <svg id="day_route" class="day_route"></svg>
         <br>
                        <p id="time"></p>
                        start:<input type="text" id="start_time" onchange="changeStartTime(this.value)">
                        end:<input type="text" id="end_time" onchange="changeEndTime(this.value)">
                        day:<input type="text" id="day" onchange="changeDay(this.value)">
                        <button onclick="runRoute()">run</button>
                        <p id ="list"></p>
        <!--<button value="all" onclick="ChangeLabelChoose(value)">all</button>-->
        <!--<button value = 'ordinary worker' onclick="ChangeLabelChoose(value)">ordinary worker</button>-->
        <!--<button value = 'manager' onclick="ChangeLabelChoose(value)">manager</button>-->
        <!--<button value = 'reporter' onclick="ChangeLabelChoose(value)">reporter</button>-->
        <!--<button value = 'guest' onclick="ChangeLabelChoose(value)">guest</button>-->
        <!--<button value = 'attendee' onclick="ChangeLabelChoose(value)">attendee</button>-->
        </div>
                </div>
            </div>
            <!--  amiddboxttop end-->
                <div class="amidd_bott">
                  <div class="amiddboxtbott1 fl" >
                    <h2 class="tith2 pt1">矛盾纠纷环比分析</h2>
                    <div id="amiddboxtbott1" class="amiddboxtbott1content" >
                        <div id="bubble">
		<svg width="350" height="250" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
                        </div>
                    </div>
                  </div>

		<div class="amiddboxtbott2 fl"><h2 class="tith2 pt1">最长逗留时间分布</h2>
			<div class="amiddboxtbott2content">
          <div id="containerlyx2" style="height: 100%"></div>
          <script type="text/javascript">
               var dom = document.getElementById("containerlyx2");
               var myChart = echarts.init(dom);
               var app = {};
               option = null;
               option = {
                  //  title : {
                  //      text: '最长逗留时间分布',
                  //  },
                   grid: {
                     top: '10%',
                       left: '0%',
                       right: '7%',
                       bottom: '3%',
                       containLabel: true
                   },
                   tooltip : {
                       // trigger: 'axis',
                       showDelay : 0,
                       formatter : function (params) {
                           if (params.value.length > 1) {
                               return params.seriesName + ' :<br/>'
                               + params.value[0] + 'cm '
                               + params.value[1] + 'kg ';
                           }
                           else {
                               return params.seriesName + ' :<br/>'
                               + params.name + ' : '
                               + params.value + 'kg ';
                           }
                       },
                       axisPointer:{
                           show: true,
                           type : 'cross',
                           lineStyle: {
                               type : 'dashed',
                               width : 1
                           }
                       }
                   },
                   toolbox: {
                       feature: {
                           dataZoom: {},
                           brush: {
                               type: ['rect', 'polygon', 'clear']
                           }
                       }
                   },
                   brush: {
                   },
                   // legend: {
                   //     data: ['女性'],
                   //     left: 'center'
                   // },
                   xAxis : [
                       {
                           type : 'value',
                           scale:true,
                           axisLabel : {
                            color: 'white',
                               formatter: '{value} cm'
                           },
                           splitLine: {
                               show: false
                           }
                       }
                   ],
                   yAxis : [
                       {
                           type : 'value',
                           scale:true,
                           axisLabel : {
                            color: 'white',
                               formatter: '{value} kg'
                           },
                           splitLine: {
                               show: false
                           }
                       }
                   ],
                   series : [
                       {
                           name:'女性',
                           type:'scatter',
                           data: [[161.2, 51.6], [167.5, 59.0], [159.5, 49.2], [157.0, 63.0], [155.8, 53.6],
                               [170.0, 59.0], [159.1, 47.6], [166.0, 69.8], [176.2, 66.8], [160.2, 75.2],
                               [172.5, 55.2], [170.9, 54.2], [172.9, 62.5], [153.4, 42.0], [160.0, 50.0],
                               [147.2, 49.8], [168.2, 49.2], [175.0, 73.2], [157.0, 47.8], [167.6, 68.8],
                               [159.5, 50.6], [175.0, 82.5], [166.8, 57.2], [176.5, 87.8], [170.2, 72.8],
                               [174.0, 54.5], [173.0, 59.8], [179.9, 67.3], [170.5, 67.8], [160.0, 47.0],
                               [154.4, 46.2], [162.0, 55.0], [176.5, 83.0], [160.0, 54.4], [152.0, 45.8],
                               [162.1, 53.6], [170.0, 73.2], [160.2, 52.1], [161.3, 67.9], [166.4, 56.6],
                               [168.9, 62.3], [163.8, 58.5], [167.6, 54.5], [160.0, 50.2], [161.3, 60.3],
                               [167.6, 58.3], [165.1, 56.2], [160.0, 50.2], [170.0, 72.9], [157.5, 59.8],
                               [167.6, 61.0], [160.7, 69.1], [163.2, 55.9], [152.4, 46.5], [157.5, 54.3],
                               [168.3, 54.8], [180.3, 60.7], [165.5, 60.0], [165.0, 62.0], [164.5, 60.3],
                               [156.0, 52.7], [160.0, 74.3], [163.0, 62.0], [165.7, 73.1], [161.0, 80.0],
                               [162.0, 54.7], [166.0, 53.2], [174.0, 75.7], [172.7, 61.1], [167.6, 55.7],
                               [151.1, 48.7], [164.5, 52.3], [163.5, 50.0], [152.0, 59.3], [169.0, 62.5],
                               [164.0, 55.7], [161.2, 54.8], [155.0, 45.9], [170.0, 70.6], [176.2, 67.2],
                               [170.0, 69.4], [162.5, 58.2], [170.3, 64.8], [164.1, 71.6], [169.5, 52.8],
                               [163.2, 59.8], [154.5, 49.0], [159.8, 50.0], [173.2, 69.2], [170.0, 55.9],
                               [161.4, 63.4], [169.0, 58.2], [166.2, 58.6], [159.4, 45.7], [162.5, 52.2],
                               [159.0, 48.6], [162.8, 57.8], [159.0, 55.6], [179.8, 66.8], [162.9, 59.4],
                               [161.0, 53.6], [151.1, 73.2], [168.2, 53.4], [168.9, 69.0], [173.2, 58.4],
                               [171.8, 56.2], [178.0, 70.6], [164.3, 59.8], [163.0, 72.0], [168.5, 65.2],
                               [166.8, 56.6], [172.7, 105.2], [163.5, 51.8], [169.4, 63.4], [167.8, 59.0],
                               [159.5, 47.6], [167.6, 63.0], [161.2, 55.2], [160.0, 45.0], [163.2, 54.0],
                               [162.2, 50.2], [161.3, 60.2], [149.5, 44.8], [157.5, 58.8], [163.2, 56.4],
                               [172.7, 62.0], [155.0, 49.2], [156.5, 67.2], [164.0, 53.8], [160.9, 54.4],
                               [162.8, 58.0], [167.0, 59.8], [160.0, 54.8], [160.0, 43.2], [168.9, 60.5],
                               [158.2, 46.4], [156.0, 64.4], [160.0, 48.8], [167.1, 62.2], [158.0, 55.5],
                               [167.6, 57.8], [156.0, 54.6], [162.1, 59.2], [173.4, 52.7], [159.8, 53.2],
                               [170.5, 64.5], [159.2, 51.8], [157.5, 56.0], [161.3, 63.6], [162.6, 63.2],
                               [160.0, 59.5], [168.9, 56.8], [165.1, 64.1], [162.6, 50.0], [165.1, 72.3],
                               [166.4, 55.0], [160.0, 55.9], [152.4, 60.4], [170.2, 69.1], [162.6, 84.5],
                               [170.2, 55.9], [158.8, 55.5], [172.7, 69.5], [167.6, 76.4], [162.6, 61.4],
                               [167.6, 65.9], [156.2, 58.6], [175.2, 66.8], [172.1, 56.6], [162.6, 58.6],
                               [160.0, 55.9], [165.1, 59.1], [182.9, 81.8], [166.4, 70.7], [165.1, 56.8],
                               [177.8, 60.0], [165.1, 58.2], [175.3, 72.7], [154.9, 54.1], [158.8, 49.1],
                               [172.7, 75.9], [168.9, 55.0], [161.3, 57.3], [167.6, 55.0], [165.1, 65.5],
                               [175.3, 65.5], [157.5, 48.6], [163.8, 58.6], [167.6, 63.6], [165.1, 55.2],
                               [165.1, 62.7], [168.9, 56.6], [162.6, 53.9], [164.5, 63.2], [176.5, 73.6],
                               [168.9, 62.0], [175.3, 63.6], [159.4, 53.2], [160.0, 53.4], [170.2, 55.0],
                               [162.6, 70.5], [167.6, 54.5], [162.6, 54.5], [160.7, 55.9], [160.0, 59.0],
                               [157.5, 63.6], [162.6, 54.5], [152.4, 47.3], [170.2, 67.7], [165.1, 80.9],
                               [172.7, 70.5], [165.1, 60.9], [170.2, 63.6], [170.2, 54.5], [170.2, 59.1],
                               [161.3, 70.5], [167.6, 52.7], [167.6, 62.7], [165.1, 86.3], [162.6, 66.4],
                               [152.4, 67.3], [168.9, 63.0], [170.2, 73.6], [175.2, 62.3], [175.2, 57.7],
                               [160.0, 55.4], [165.1, 104.1], [174.0, 55.5], [170.2, 77.3], [160.0, 80.5],
                               [167.6, 64.5], [167.6, 72.3], [167.6, 61.4], [154.9, 58.2], [162.6, 81.8],
                               [175.3, 63.6], [171.4, 53.4], [157.5, 54.5], [165.1, 53.6], [160.0, 60.0],
                               [174.0, 73.6], [162.6, 61.4], [174.0, 55.5], [162.6, 63.6], [161.3, 60.9],
                               [156.2, 60.0], [149.9, 46.8], [169.5, 57.3], [160.0, 64.1], [175.3, 63.6],
                               [169.5, 67.3], [160.0, 75.5], [172.7, 68.2], [162.6, 61.4], [157.5, 76.8],
                               [176.5, 71.8], [164.4, 55.5], [160.7, 48.6], [174.0, 66.4], [163.8, 67.3]
                           ],
                           markArea: {
                               silent: true,
                               itemStyle: {
                                   normal: {
                                       color: 'transparent',
                                       borderWidth: 1,
                                       borderType: 'dashed'
                                   }
                               },
                               data: [[{
                                  //  name: '分布区间',
                                   xAxis: 'min',
                                   yAxis: 'min'
                               }, {
                                   xAxis: 'max',
                                   yAxis: 'max'
                               }]]
                           },
                          //  markPoint : {
                          //      data : [
                          //          {type : 'max', name: '最大值'},
                          //          {type : 'min', name: '最小值'}
                          //      ]
                          //  },
                           markLine : {
                               lineStyle: {
                                   normal: {
                                       type: 'solid'
                                   }
                               },
                               data : [
                                   {type : 'average', name: '平均值'},
                                   { xAxis: 160 }
                               ]
                           }
                       }
                   ]
               };
               if (option && typeof option === "object") {
                   myChart.setOption(option, true);
               }
          </script>
			</div>
		</div>
          </div>
      </div>

        <div class="mrbox_top_right">
            <div class="arightboxtop"><h2 class="tith2">人员分布统计图</h2>
			<div id="container" style="height: 100%; margin-bottom: 10%"></div>
			<script src="../static/scripts/DrawBar.js"></script>
            </div>
            <div class="arightboxbott"><h2 class="tith2 ">人员构成</h2>
              <div id="arightboxbott" class="arightboxbottcont" style="">
                  <div id="person_distribution"></div>
                  <button value="0" onclick="ChangeDay(value)">day 1</button>
                  <button value="1" onclick="ChangeDay(value)">day 2</button>
                  <button value="2" onclick="ChangeDay(value)">day 3</button>
              </div>
            </div>
        </div>
</div>
    </div>

        <script>
            label_choose = 'all';
            function ChangeLabelChoose(val){
                label_choose = val;
            }
            function ChangeDay(val){
                val=parseInt(val);
                currentDay = val;
                world_cloud.update_by_day(val);
            }
            //drawFlow();
            //{#drawBubble(1,currentTime);#}
            drawChord();
            var world_cloud = DrawWorldCloud(0);
            //world_cloud.update_by_day(1);
            //第二天修改为2
            route = drawMainActive(0,37000);
            function Update(currentTime){
                // {#console.log(currentTime);#}
                //console.log(currentTime);
                route.update(currentTime);
            }
            function changeStartTime(val){
                tmp_currentTime = val;
            }
            function changeEndTime(val){
                tmp_endTime = val;
            }
            function changeDay(val){
                tmp_day=val;
            }
            function runRoute(){
                currentTime = tmp_currentTime;
                endTime = tmp_endTime;
                route = drawMainActive(tmp_day,currentTime);
            }
        </script>
    </body>
<script>
    //当天的开始时间
  currentTime = 37000;
  endTime = 45164;
  //flag=true;
  var currentDay = 2;
  //drawBubble(currentDay,currentTime);
    setTimeout(function () {
        //if(!flag) return;
        //当天的结束时间
    if(currentTime<endTime){
        //console.log(currentTime);
        var p=document.getElementById("time");
        p.innerHTML = currentTime.toString();
      Update(currentTime);
      currentTime++;
      setTimeout(arguments.callee, 0.1)
    }
    else currentTime = 27070;
  },0.1);
</script>


<script type="text/javascript">
	
</script>
</html>
