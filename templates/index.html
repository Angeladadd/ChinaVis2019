<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="https://d3js.org/d3.v4.js"></script> 
		<script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
        <script src="../static/scripts/d3.layout.cloud.js"></script>
        <script src="../static/scripts/d3-legend.min.js"></script>
        <script scr="../static/scripts/D1per10min.js"></script>
	    <script src="../static/scripts/DrawFlow.js"></script>
        <script src = "../static/scripts/DrawRoute.js"></script>
		<script src = "../static/scripts/d1labelcountper10min.js"></script>
		<script src = "../static/scripts/d2labelcountper10min.js"></script>
		<script src = "../static/scripts/d3labelcountper10min.js"></script>
		<script src = "../static/scripts/d1labelcountpermin.js"></script>
		<script src = "../static/scripts/d2labelcountpermin.js"></script>
		<script src = "../static/scripts/d3labelcountpermin.js"></script>
        <script src = "../static/scripts/number_time_day1.js"></script>
        <script src = "../static/scripts/number_time_day2.js"></script>
        <script src = "../static/scripts/number_time_day3.js"></script>
    	<script src = "../static/scripts/sensor_deployment.js"></script>
        <script src = "../static/scripts/id_label.js"></script>
        <script src = "../static/scripts/D1per10min.js"></script>
        <script src = "../static/scripts/D2per10min.js"></script>
        <script src = "../static/scripts/D3per10min.js"></script>
    	<!-- <script src = "../static/scripts/sensor_deployment.js"></script> -->
        <script src = "../static/scripts/DrawBubble.js"></script>
        <script src = "../static/scripts/DrawChord.js"></script>
        <script src = "../static/scripts/DrawWordCloud.js"></script>
        <link href="../static/css/style.css"  rel="stylesheet" type="text/css" media="all" />
        <style>
            /*#day_route{*/
                /*background: url(https://github.com/Angeladadd/ChinaVis2019/blob/cc86772a65976d4ad933450d589f0790444a1042/static/img/background.png);*/
            /*}*/
        </style>
        <script>
            // var label = [];
            // for (var key in id_label){
            //     var tmp = id_label[key];
            //     if(label.indexOf(tmp)>=0){
            //         continue;
            //     }
            //     else{
            //         label.push(tmp);
            //         document.write(tmp+" ");
            //     }
            // }
            data_day1 = {{data_day1|tojson}}
            data_day2 = {{data_day2|tojson}}
            data_day3 = {{data_day3|tojson}}
            sensor_deployment = {{sensor|tojson}}
            //基本数据
            var sensor = {x_max:15,x_min:0,y_max:28,y_min:0};
            BASIC_DATA = {sensor:sensor,people_MAX:25};
            var people_map = {};
            var sensor_map = {};

            for(var i=0;i<sensor_deployment.length;i++){
                sensor_map[sensor_deployment[i].sid] = i;
            }
            //统计一天的people，目前只处理了第一天的，还不知道这个代码到时候放哪
            //这个地方非常瓶颈，建议后端直接做成json，后端如果要加的话尽量把people做成这个数据结构8
            people = new Array(3);
            people[0] = new Array(0);
            people[1] = new Array(0);
            people[2] = new Array(0);
            var cnt = -1;
            //为了加载快，这里只计算一天
            //第二天修改所有的people[0]为 people[1], data_day1为data_day2
            for(var i=0;i<data_day1.length;i++){
                let id = data_day1[i].id;
                let sid = data_day1[i].sid;
                let time = data_day1[i].time;
                var d_obj;
                if(!people_map.hasOwnProperty(id)){
                    cnt++;
                    people_map[id] = cnt;
                    people[0][cnt] = new Array(0);
                    d_obj = {};
                    var sensor_tmp = sensor_deployment[sensor_map[sid]];
                    d_obj.x = parseInt(-1);
                    d_obj.y = parseInt(-1);
                    d_obj.floor = parseInt(sensor_tmp.floor);
                    d_obj.time = parseInt(time);
                    d_obj.id = parseInt(id);
                    d_obj.sensor_simple_id = sensor_map[sid];
                    people[0][cnt].push(d_obj);
                }
                var index = parseInt(people_map[id]);

                var obj = {};
                var sensor_tmp = sensor_deployment[sensor_map[sid]];
                obj.x = parseInt(sensor_tmp.x);
                obj.y = parseInt(sensor_tmp.y);
                obj.floor = parseInt(sensor_tmp.floor);
                obj.time = parseInt(time);
                obj.id = parseInt(id);
                obj.sensor_simple_id = sensor_map[sid];

                if(people[0][index]) people[0][index].push(obj);
            }
            for(var i=0;i<people[0].length;i++)
                people[0][i].push(d_obj);

            MAP = {people_map:people_map,sensor_map:sensor_map};
            sensor_all_floor = new Array(0);
            for(let i=0;i<sensor_deployment.length;i++){
                sensor_all_floor.push(sensor_deployment[i]);
            }

        </script>

    </head>

    <body>
    <div class="wpbox">
<div class="bnt">
  <div class="topbnt_left fl">
      <!--这里是可以跳新页面的操作-->
   <ul><li class="active"><a href="#">警情警力</a></li>
      <li><a href="#">实有人口</a></li>
      <li><a href="#">流动人口</a></li>
      <li><a href="#">实名制</a></li>
   </ul>
  </div>
  <h1 class="tith1 fl">China Vis 2019</h1>
  <div class=" fr topbnt_right">
    <ul>
       <li><a href="#">返回</a></li>
       <li><a href="#">分析报告</a></li>
       <li><a href="#">交通</a></li>
       <li><a href="#">舆情</a></li>
    </ul>
   </ul>
  </div>
</div>
<!-- bnt end -->
<div class="left1">
    <div class="aleftboxttop"><h2 class="tith2">今日矛盾纠纷数据统计</h2>
    <div class="lefttoday_tit" style=" height:8%"><p class="fl">地区：甘孜</p><p class="fr">2018-06-14</p></div>
    <div class="lefttoday_number">
      <div class="widget-inline-box text-center fl">
      </div>
    </div>
    <!-- lefttoday_number end -->
    </div>
    <div class="aleftboxtmidd">
      <h2 class="tith2">矛盾纠纷地区统计</h2>
<!-- {#        <div id="liuyuxiang">#}
{#            <select id="selectButton"></select>#}
{#            <div id="vis1"></div>#}
{#        </div>#} -->
      <div id="aleftboxtmidd" class="aleftboxtmiddcont"></div>
  </div>
  <div class="aleftboxtbott">
    <h2 class="tith2">矛盾纠纷类型统计</h2>
    <div id="aleftboxtbott" class="aleftboxtbott_cont" >
        <div id="chord">
         <svg width="280" height="280"></svg>
        </div>
    </div>
</div>
</div>
<!--  left1 end -->
<div class="mrbox">
      <div class="mrbox_topmidd" style="width: 69%;">
          <div class="amiddboxttop">
              <h2 class="tith2 pt1">实时监控统计</h2>
                <div class="amiddboxttop_map" style="">
                    <div id="main_active">
        <svg id="day_route" class="day_route"></svg>
         <br>
                        <p id="time"></p>
                        <p id ="list"></p>
        <!--<button value="all" onclick="ChangeLabelChoose(value)">all</button>-->
        <!--<button value = 'ordinary worker' onclick="ChangeLabelChoose(value)">ordinary worker</button>-->
        <!--<button value = 'manager' onclick="ChangeLabelChoose(value)">manager</button>-->
        <!--<button value = 'reporter' onclick="ChangeLabelChoose(value)">reporter</button>-->
        <!--<button value = 'guest' onclick="ChangeLabelChoose(value)">guest</button>-->
        <!--<button value = 'attendee' onclick="ChangeLabelChoose(value)">attendee</button>-->
        </div>
                </div>
            </div>
            <!--  amiddboxttop end-->
                <div class="amidd_bott">
                  <div class="amiddboxtbott1 fl" >
                    <h2 class="tith2 pt1">矛盾纠纷环比分析</h2>
                    <div id="amiddboxtbott1" class="amiddboxtbott1content" >
                        <div id="bubble">
		<svg width="350" height="250" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
                        </div>
                    </div>
                  </div>

		<div class="amiddboxtbott2 fl"><h2 class="tith2 pt1">案件统计</h2>
			<div class="amiddboxtbott2content">
			</div>
		</div>



            <!-- amidd_bott end -->
          </div>
      </div>
        <!-- mrbox_top end -->
        <div class="mrbox_top_right">
            <div class="arightboxtop"><h2 class="tith2">警力分析</h2>
            <!-- <div class="lefttoday_tit"><p class="fl">状态：已调节</p><p class="fr">时间段：2018-06-10</p></div>
            <div class="left2_table">
               <ul>
                    <li>
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li class="bg">
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li>
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li class="bg">
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li>
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li class="bg">
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li>
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>
                    <li class="bg">
                    <p class="fl"><b>康定市公安局</b><br>
                      村名王某因为被隔壁邻居的狗咬了，产生了纠纷，村名报警。<br>
                    </p>
                    <p class="fr pt17">2018-06-22</p>
                    </li>

               </ul>
			</div> -->
			<div id="container" style="height: 100%; margin-bottom: 10%"></div>
				
				<script type="text/javascript">
					// console.log(D1per10min);
					groups = [];
					groupData = [];
					time = [];
					for(var i in Object.keys(D1per10min)){
						groups.push(Object.keys(D1per10min)[i]);
						groupData.push(D1per10min[Object.keys(D1per10min)[i]]);
						
					}
					for(var j=0; j<groupData[0].length; j++){
						time.push(j * 10);
					}
					console.log(time);
					// console.log(groups);
					// console.log(groupData);

					var dom = document.getElementById("container");
					var myChart = echarts.init(dom);
					var app = {};
					option = null;
					app.title = '堆叠条形图';

					option = {
						tooltip : {
							trigger: 'axis',
							axisPointer : {            // 坐标轴指示器，坐标轴触发有效
								type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
							}
						},
						// legend: {
						// 	// data: ['直接访问', '邮件营销','联盟广告','视频广告','搜索引擎']
						// 	data: groups
						// },
						grid: {
							left: '3%',
							right: '5%',
							bottom: '10%',
							containLabel: true
						},
						yAxis:  {
							type: 'value'
						},
						xAxis: {
							type: 'category',
							// data: ['周一','周二','周三','周四','周五','周六','周日']
							data: time
						},
						series: [
							{
								// name: '直接访问',
								name: groups[0],
								type: 'bar',
								stack: '总量',
								// data: [320, 302, 301, 334, 390, 330, 320]
								data: groupData[0]
							},
							{
								// name: '邮件营销',
								name: groups[1],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[1]
							},
							{
								// name: '联盟广告',
								name: groups[2],
								type: 'bar',
								stack: '总量',
								// data: [220, 182, 191, 234, 290, 330, 310]
								data: groupData[2]
							},
							{
								// name: '视频广告',
								name: groups[3],
								type: 'bar',
								stack: '总量',
								// data: [150, 212, 201, 154, 190, 330, 410]
								data: groupData[3]
							},
							{
								// name: '搜索引擎',
								name: groups[4],
								type: 'bar',
								stack: '总量',
								// data: [820, 832, 901, 934, 1290, 1330, 1320]
								data: groupData[4]
							},
							{
								// name: '邮件营销',
								name: groups[5],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[5]
							},
							{
								// name: '邮件营销',
								name: groups[6],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[6]
							},
							{
								// name: '邮件营销',
								name: groups[7],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[7]
							},
							{
								// name: '邮件营销',
								name: groups[8],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[8]
							},
							{
								// name: '邮件营销',
								name: groups[9],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[9]
							},
							{
								// name: '邮件营销',
								name: groups[10],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[10]
							},
							{
								// name: '邮件营销',
								name: groups[11],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[11]
							},
							{
								// name: '邮件营销',
								name: groups[12],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[12]
							},
							{
								// name: '邮件营销',
								name: groups[13],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[13]
							},
							{
								// name: '邮件营销',
								name: groups[14],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[14]
							},
							{
								// name: '邮件营销',
								name: groups[15],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[15]
							},
							{
								// name: '邮件营销',
								name: groups[16],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[16]
							},
							{
								// name: '邮件营销',
								name: groups[17],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[17]
							},
							{
								// name: '邮件营销',
								name: groups[18],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[18]
							},
							{
								// name: '邮件营销',
								name: groups[19],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[19]
							},
							{
								// name: '邮件营销',
								name: groups[20],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[20]
							},
							{
								// name: '邮件营销',
								name: groups[21],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[21]
							},
							{
								// name: '邮件营销',
								name: groups[22],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[22]
							},
							{
								// name: '邮件营销',
								name: groups[23],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[23]
							},
							{
								// name: '邮件营销',
								name: groups[24],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[24]
							},
							{
								// name: '邮件营销',
								name: groups[25],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[25]
							},
							{
								// name: '邮件营销',
								name: groups[26],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[26]
							},
							{
								// name: '邮件营销',
								name: groups[27],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[27]
							},
							{
								// name: '邮件营销',
								name: groups[28],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[28]
							},
							{
								// name: '邮件营销',
								name: groups[29],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[29]
							},
							{
								// name: '邮件营销',
								name: groups[30],
								type: 'bar',
								stack: '总量',
								// data: [120, 132, 101, 134, 90, 230, 210]
								data: groupData[30]
							}
						]
					};
					if (option && typeof option === "object") {
						myChart.setOption(option, true);
					}
				</script>
            </div>
            <div class="arightboxbott"><h2 class="tith2 ">人员构成</h2>
              <div id="arightboxbott" class="arightboxbottcont" style="">
                  <div id="person_distribution"></div>
                  <button value="0" onclick="ChangeDay(value)">day 1</button>
                  <button value="1" onclick="ChangeDay(value)">day 2</button>
                  <button value="2" onclick="ChangeDay(value)">day 3</button>
              </div>
            </div>
        </div>
        <!-- mrbox_top_right end -->
</div>
    </div>
  
        <script>
            label_choose = 'all';
            function ChangeLabelChoose(val){
                label_choose = val;
            }
            function ChangeDay(val){
                val=parseInt(val);
                currentDay = val;
                world_cloud.update_by_day(val);
            }
            drawFlow();
            {#drawBubble(1,currentTime);#}
            drawChord();
            var world_cloud = DrawWorldCloud(0);
            //world_cloud.update_by_day(1);
            //第二天修改为2
            var route = drawMainActive(1);
            function Update(currentTime){
                // {#console.log(currentTime);#}
                //console.log(currentTime);
                route.update(currentTime);
            }
        </script>
    </body>
<script>
    //当天的开始时间
  var currentTime = 25240;
  var currentDay = 2;
  drawBubble(currentDay,currentTime);
    setTimeout(function () {
        //当天的结束时间
    if(currentTime<64859){
        //console.log(currentTime);
        var p=document.getElementById("time");
        p.innerHTML = currentTime.toString();
      Update(currentTime);
      currentTime++;
      setTimeout(arguments.callee, 0.1)
    }
    else currentTime = 25240;
  },0.1);
</script>
</html>
