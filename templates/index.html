<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="https://d3js.org/d3.v4.js"></script> 
        <script src="https://unpkg.com/d3@5.6.0/dist/d3.min.js"></script>
	<script src="https://cdn.bootcss.com/wordcloud2.js/1.1.0/wordcloud2.js"></script>
	<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
        <script src="../static/scripts/d3-legend.min.js"></script>
	    <script src="../static/scripts/DrawFlow.js"></script>
        <script src = "../static/scripts/DrawRoute.js"></script>
        <script src = "../static/scripts/number_time_day1.js"></script>
        <script src = "../static/scripts/number_time_day2.js"></script>
        <script src = "../static/scripts/number_time_day3.js"></script>
    	<script src = "../static/scripts/sensor_deployment.js"></script>
        <script src = "../static/scripts/id_label.js"></script>
    	<!-- <script src = "../static/scripts/sensor_deployment.js"></script> -->
        <script src = "../static/scripts/DrawBubble.js"></script>
        <script src = "../static/scripts/DrawChord.js"></script>
        <link href="../static/css/style.css"  rel="stylesheet" type="text/css" media="all" />
        <script>
            // var label = [];
            // for (var key in id_label){
            //     var tmp = id_label[key];
            //     if(label.indexOf(tmp)>=0){
            //         continue;
            //     }
            //     else{
            //         label.push(tmp);
            //         document.write(tmp+" ");
            //     }
            // }
            data_day1 = {{data_day1|tojson}}
            data_day2 = {{data_day2|tojson}}
            data_day3 = {{data_day3|tojson}}
            sensor_deployment = {{sensor|tojson}}
            //基本数据
            var sensor = {x_max:15,x_min:0,y_max:28,y_min:0};
            BASIC_DATA = {sensor:sensor,people_MAX:25};
            var people_map = {};
            var sensor_map = {};

            for(var i=0;i<sensor_deployment.length;i++){
                sensor_map[sensor_deployment[i].sid] = i;
            }
            //统计一天的people，目前只处理了第一天的，还不知道这个代码到时候放哪
            //这个地方非常瓶颈，建议后端直接做成json，后端如果要加的话尽量把people做成这个数据结构8
            people = new Array(3);
            people[0] = new Array(0);
            var cnt = -1;
            for(var i=0;i<data_day1.length;i++){
                let id = data_day1[i].id;
                let sid = data_day1[i].sid;
                let time = data_day1[i].time;
                var d_obj;
                if(!people_map.hasOwnProperty(id)){
                    cnt++;
                    people_map[id] = cnt;
                    people[0][cnt] = new Array(0);
                    d_obj = {};
                    var sensor_tmp = sensor_deployment[sensor_map[sid]];
                    d_obj.x = parseInt(-1);
                    d_obj.y = parseInt(-1);
                    d_obj.floor = parseInt(sensor_tmp.floor);
                    d_obj.time = parseInt(time);
                    d_obj.id = parseInt(id);
                    d_obj.sensor_simple_id = sensor_map[sid];
                    people[0][cnt].push(d_obj);
                }
                var index = parseInt(people_map[id]);

                var obj = {};
                var sensor_tmp = sensor_deployment[sensor_map[sid]];
                obj.x = parseInt(sensor_tmp.x);
                obj.y = parseInt(sensor_tmp.y);
                obj.floor = parseInt(sensor_tmp.floor);
                obj.time = parseInt(time);
                obj.id = parseInt(id);
                obj.sensor_simple_id = sensor_map[sid];

                if(people[0][index]) people[0][index].push(obj);
            }
            for(var i=0;i<people[0].length;i++)
                people[0][i].push(d_obj);

            MAP = {people_map:people_map,sensor_map:sensor_map};
            sensor_all_floor = new Array(0);
            for(let i=0;i<sensor_deployment.length;i++){
                sensor_all_floor.push(sensor_deployment[i]);
            }
            label_choose = 'all';

        </script>

    </head>

    <body>
    <div class="wpbox">
<div class="bnt">
  <div class="topbnt_left fl">
      <!--这里是可以跳新页面的操作-->
   <ul><li class="active"><a href="#">警情警力</a></li>
      <li><a href="#">实有人口</a></li>
      <li><a href="#">流动人口</a></li>
      <li><a href="#">实名制</a></li>
   </ul>
  </div>
  <h1 class="tith1 fl">China Vis 2019</h1>
  <div class=" fr topbnt_right">
    <ul>
       <li><a href="#">返回</a></li>
       <li><a href="#">分析报告</a></li>
       <li><a href="#">交通</a></li>
       <li><a href="#">舆情</a></li>
    </ul>
   </ul>
  </div>
</div>
<!-- bnt end -->
<div class="left1">
    <div class="aleftboxttop"><h2 class="tith2">今日矛盾纠纷数据统计</h2>
    <div class="lefttoday_tit" style=" height:8%"><p class="fl">地区：甘孜</p><p class="fr">2018-06-14</p></div>
    <div class="lefttoday_number">
      <div class="widget-inline-box text-center fl">
        <p>矛盾纠纷</p>
        <h3 class="ceeb1fd">54</h3>
        <h4 class="text-muted pt6">环比<img src="img/iconup.png" height="16" />2%</h4>
      </div>
      <div class="widget-inline-box text-center fl">
         <p>已调节</p>
        <h3 class="c24c9ff">54</h3>
        <h4 class="text-muted pt6">环比<img src="img/icondown.png" height="16" />3%</h4>
      </div>
      <div class="widget-inline-box text-center fl">
         <p>未调节</p>
        <h3 class="cffff00">4</h3>
        <h4 class="text-muted pt6">环比<img src="img/icondown.png" height="16" />3%</h4>
      </div>
      <div class="widget-inline-box text-center fl">
         <p>处理中</p>
        <h3 class="c11e2dd">4</h3>
        <h4 class="text-muted pt6">环比<img src="img/icondown.png" height="16" />3%</h4>
      </div>
    </div>
    <!-- lefttoday_number end -->
    </div>
    <div class="aleftboxtmidd">
      <h2 class="tith2">矛盾纠纷地区统计</h2>
        <div id="liuyuxiang">
            <select id="selectButton"></select>
            <div id="vis1"></div>
        </div>
      <div id="aleftboxtmidd" class="aleftboxtmiddcont"></div>
  </div>
  <div class="aleftboxtbott">
    <h2 class="tith2">矛盾纠纷类型统计</h2>
    <div id="aleftboxtbott" class="aleftboxtbott_cont" >
        <div id="chord">
         <svg width="280" height="280"></svg>
        </div>
    </div>
</div>
</div>
<!--  left1 end -->
<div class="mrbox">
      <div class="mrbox_topmidd" style="width: 69%;">
          <div class="amiddboxttop">
              <h2 class="tith2 pt1">实时监控统计</h2>
                <div class="amiddboxttop_map" style="">
                    <div id="main_active">
        <svg id="day_route"></svg>
         <br>
        <button value="all" onclick="ChangeLabelChoose(value)">all</button>
        <button value = 'ordinary worker' onclick="ChangeLabelChoose(value)">ordinary worker</button>
        <button value = 'manager' onclick="ChangeLabelChoose(value)">manager</button>
        <button value = 'reporter' onclick="ChangeLabelChoose(value)">reporter</button>
        <button value = 'guest' onclick="ChangeLabelChoose(value)">guest</button>
        <button value = 'attendee' onclick="ChangeLabelChoose(value)">attendee</button>
        </div>
                </div>
            </div>
            <!--  amiddboxttop end-->
                <div class="amidd_bott">
                  <div class="amiddboxtbott1 fl" >
                    <h2 class="tith2 pt1">矛盾纠纷环比分析</h2>
                    <div id="amiddboxtbott1" class="amiddboxtbott1content" >
                        <div id="bubble">
		<svg width="350" height="250" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
                        </div>
                    </div>
                  </div>

                <div class="amiddboxtbott2 fl"><h2 class="tith2 pt1">案件统计</h2>
                  <div id="container" style="height: 100%"></div>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
                  <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&__ec_v__=20190126"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
                  <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
                </div>
                    <script type="text/javascript">
                    var dom = document.getElementById("container");
var myChart = echarts.init(dom);
var app = {};
option = null;
app.title = '堆叠条形图';

option = {
    tooltip : {
        trigger: 'axis',
        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
        }
    },
    legend: {
        data: ['直接访问', '邮件营销','联盟广告','视频广告','搜索引擎']
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis:  {
        type: 'value'
    },
    yAxis: {
        type: 'category',
        data: ['周一','周二','周三','周四','周五','周六','周日']
    },
    series: [
        {
            name: '直接访问',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    position: 'insideRight'
                }
            },
            data: [320, 302, 301, 334, 390, 330, 320]
        },
        {
            name: '邮件营销',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    position: 'insideRight'
                }
            },
            data: [120, 132, 101, 134, 90, 230, 210]
        },
        {
            name: '联盟广告',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    position: 'insideRight'
                }
            },
            data: [220, 182, 191, 234, 290, 330, 310]
        },
        {
            name: '视频广告',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    position: 'insideRight'
                }
            },
            data: [150, 212, 201, 154, 190, 330, 410]
        },
        {
            name: '搜索引擎',
            type: 'bar',
            stack: '总量',
            label: {
                normal: {
                    show: true,
                    position: 'insideRight'
                }
            },
            data: [820, 832, 901, 934, 1290, 1330, 1320]
        }
    ]
};;
if (option && typeof option === "object") {
    myChart.setOption(option, true);
}
</script>
            </div>
            <!-- amidd_bott end -->
          </div>
        <!-- mrbox_top end -->
        <div class="mrbox_top_right">
          
            <div id="canvas-container" align="center">
    		<canvas id="canvas" width="300px" height="200px"><script>
    		var options = eval({
        	"list": [['海报区', 0], ['扶梯1', 1], ['room5', 2], ['扶梯3', 3], ['exit1', 4], ['厕所1', 5], ['entry4', 6], ['服务台', 7], ['room4', 8], ['B', 9], ['exit4', 10], ['餐厅', 11], ['C', 12], ['扶梯4', 13], ['0', 14], ['休闲区', 15], ['entry2', 16], ['A', 17], ['room3', 18], ['exit2', 19], ['展厅', 20], ['entry1', 21], ['room1', 22], ['厕所3', 23], ['exit3', 24], ['厕所2', 25], ['room6', 26], ['主会场', 27], ['room2', 28], ['entry3', 29], ['签到处', 30]],
        	"gridSize": 5, // size of the grid in pixels
        	"weightFactor": 1, // number to multiply for size of each word in the list
        	"fontWeight": 'normal', // 'normal', 'bold' or a callback
        	"fontFamily": 'Times, serif', // font to use
        	"color": 'random-light', // 'random-dark' or 'random-light'
       	 	"backgroundColor": '#000', // the color of canvas
       	 	"rotateRatio": 1 // probability for the word to rotate. 1 means always rotate
    		});
    		var canvas = document.getElementById('canvas');
    		WordCloud(canvas, options);
		</script></canvas>
		</div>
           

          </div>
            <div class="arightboxbott"><h2 class="tith2 ">矛盾纠纷七日数据分析</h2>
              <div class="lefttoday_tit"><p class="fl">状态：已调节</p><p class="fr">时间：2018-06-14</p></div>
              <div id="arightboxbott" class="arightboxbottcont" style=""></div>
            </div>
        </div>
        <!-- mrbox_top_right end -->
      </div>

    </div>
</div>
        <script>
            function ChangeLabelChoose(val){
                label_choose = val;
            }
            drawFlow();
            drawBubble();
            drawChord();
            //
            var route = drawMainActive(1);
            function Update(currentTime){
                // {#console.log(currentTime);#}
                console.log(currentTime);
                route.update(currentTime);
            }
        </script>
    </body>
<script>
  var currentTime = 25240;
    setTimeout(function () {
    if(currentTime<31270){
      Update(currentTime);
      currentTime++;
      setTimeout(arguments.callee, 0.1)
    }
    else currentTime = 25240;
  },0.1);
</script>
</html>
